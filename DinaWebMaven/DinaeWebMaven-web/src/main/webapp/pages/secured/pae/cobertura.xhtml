<!DOCTYPE html>
<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    template="/templates/plantillaPrincipal.xhtml">
    <ui:define
        name="content">
        <p:panel 
            id="main"
            styleClass="ui-fluid">
            <h:form
                id="frmlist"
                prependId="false"
                rendered="#{coberturaController.showList}">
                <h:outputText 
                    value="#{bundle['cobertura.title.list']}"/>
                <p:separator />
                <p:panel
                    id="pnlfiltro">
                    <p:panelGrid
                        layout="grid" 
                        columns="2"
                        columnClasses="ui-grid-col-2,ui-grid-col-10" 
                        styleClass="ui-panelgrid-blank">
                        <!-- vigencia -->
                        <p:outputLabel
                            id="fltvigencialbl"
                            for="fltvigencia"
                            value="#{bundle['vigencia']}"/>
                        <h:panelGroup>
                            <p:selectOneMenu 
                                id="fltvigencia" 
                                value="#{coberturaController.filtro.pae}" 
                                converter="paeConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="true">
                                <p:ajax 
                                    listener="#{coberturaController.onLoadList()}" 
                                    update="pnlfiltrobtns fltvigencialbl fltvigencia fltvigenciamsg dtlist"/>
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{coberturaController.vigencias}" 
                                    var="pae" 
                                    itemLabel="#{pae.vigencia}" 
                                    itemValue="#{pae}" />
                            </p:selectOneMenu>              
                            <p:message
                                id="fltvigenciamsg"
                                for="fltvigencia"/>
                        </h:panelGroup>
                        <!-- escuela -->
                        <p:outputLabel
                            for="fltescuela"
                            value="#{bundle['escuela']}"/>
                        <h:panelGroup>
                            <p:selectOneMenu 
                                id="fltescuela" 
                                value="#{coberturaController.filtro.escuela}" 
                                converter="unidadDependenciaConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="false">
                                <p:ajax 
                                    listener="#{coberturaController.onLoadList()}" 
                                    update="pnlfiltrobtns dtlist"/>
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{coberturaController.escuelas}" 
                                    var="escuela" 
                                    itemLabel="#{escuela.descripcionDependencia}" 
                                    itemValue="#{escuela}" />
                            </p:selectOneMenu>              
                            <p:message
                                for="fltescuela"/>
                        </h:panelGroup>
                        <!-- estrategia -->
                        <p:outputLabel
                            for="fltestrategia"
                            value="#{bundle['estrategia']}"/>
                        <h:panelGroup>
                            <p:selectOneMenu 
                                id="fltestrategia" 
                                value="#{coberturaController.filtro.estrategia}" 
                                converter="dominioConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="false">
                                <p:ajax 
                                    listener="#{coberturaController.onLoadList()}" 
                                    update="pnlfiltrobtns dtlist"/>
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{coberturaController.estrategias}" 
                                    var="estrategia" 
                                    itemLabel="#{estrategia.nombre}" 
                                    itemValue="#{estrategia}" />
                            </p:selectOneMenu>              
                            <p:message
                                for="fltestrategia"/>
                        </h:panelGroup>
                    </p:panelGrid>
                    <f:facet
                        name="footer">
                        <p:panelGrid
                            id="pnlfiltrobtns"
                            columns="6"
                            layout="grid" 
                            columnClasses="ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2" 
                            styleClass="ui-panelgrid-blank">
                            <p:commandButton 
                                value="#{bundle['commons.btn.find']}"
                                title="#{bundle['commons.btn.find']}"
                                icon="ui-icon-search"
                                actionListener="#{coberturaController.onLoadList()}"
                                process="@this pnlfiltro"
                                update="frmlist"
                                style="border: none"/>
                            <p:commandButton 
                                id="btnCreate" 
                                value="#{bundle['commons.btn.new']}"
                                title="#{bundle['commons.btn.new']}"
                                icon="ui-icon-document"
                                actionListener="#{coberturaController.onCreate()}"
                                update=":main"
                                rendered="#{coberturaController.enableCreate()}"
                                style="border: none"/>
                            <p:commandButton 
                                value="#{bundle['commons.btn.remove']}"
                                title="#{bundle['commons.btn.remove']}"
                                icon="ui-icon-trash"
                                actionListener="#{coberturaController.onDelete()}"
                                immediate="true"
                                rendered="#{coberturaController.enableDelete()}"
                                update="pnlfiltrobtns dtlist"
                                style="border: none">
                                <p:confirm 
                                    header="#{bundle['commons.cfmdlg.header']}" 
                                    message="#{bundle['commons.cfmdlg.remove.message']}" 
                                    icon="ui-icon-alert" />
                            </p:commandButton>
                            <p:commandButton 
                                ajax="false" 
                                value="#{bundle['commons.btn.report']}"
                                style="border: none">                                 
                                <p:dataExporter 
                                    type="csv" 
                                    target="dtlist" 
                                    fileName="list" />
                            </p:commandButton>                    
                        </p:panelGrid>
                    </f:facet>
                </p:panel>
                <p:dataTable 
                    id="dtlist"
                    value="#{coberturaController.list}"
                    var="record"
                    paginator="true" 
                    rows="10"
                    paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                    rowsPerPageTemplate="10,50,100"
                    selectionMode="single" 
                    selection="#{coberturaController.selected}" 
                    rowKey="#{record.id}"
                    reflow="true"
                    style="font-size: smaller">               
                    <p:ajax 
                        event="rowSelect" 
                        update="pnlfiltrobtns dtlist" />
                    <p:ajax 
                        event="rowUnselect" 
                        update="pnlfiltrobtns dtlist" />
                    <p:column 
                        headerText="#{bundle['cobertura.escuela']}"
                        sortBy="#{record.escuela.descripcionDependencia}"
                        filterBy="#{record.escuela.descripcionDependencia}"
                        filterMatchMode="contains">
                        <h:outputText 
                            value="#{record.escuela.descripcionDependencia}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['cobertura.estrategia']}"
                        sortBy="#{record.estrategia.nombre}"
                        filterBy="#{record.estrategia.nombre}"
                        filterMatchMode="contains">
                        <h:outputText 
                            value="#{record.estrategia.nombre}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['cobertura.unidad']}"
                        sortBy="#{record.unidad.descripcionDependencia}"
                        filterBy="#{record.unidad.descripcionDependencia}"
                        filterMatchMode="contains">
                        <h:outputText 
                            value="#{record.unidad.descripcionDependencia}"/>
                    </p:column>
                </p:dataTable>
            </h:form>
            <h:form
                id="frmDetail"
                prependId="false"
                rendered="#{coberturaController.showDetails}">
                <h:outputText 
                    value="#{bundle['cobertura.title.detail']}"/>
                <p:separator />
                <p:panel
                    id="pnlDetails">
                    <p:panelGrid
                        columns="2"
                        layout="grid" 
                        columnClasses="ui-grid-col-2,ui-grid-col-10" 
                        styleClass="ui-panelgrid-blank">
                        <!-- vigencia -->
                        <p:outputLabel
                            for="vigencia"
                            value="#{bundle['vigencia']}"/>
                        <h:panelGroup>
                            <h:outputText
                                value="#{coberturaController.selected.pae.vigencia}"
                                rendered="#{!coberturaController.editable}"/>
                            <p:selectOneMenu 
                                id="vigencia" 
                                value="#{coberturaController.selected.pae}"
                                converter="paeConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="true"
                                rendered="#{coberturaController.editable}">
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{coberturaController.vigencias}" 
                                    var="vigencia" 
                                    itemLabel="#{vigencia.vigencia}" 
                                    itemValue="#{vigencia}" />
                            </p:selectOneMenu>              
                            <p:message
                                for="vigencia"/>
                        </h:panelGroup>
                        <!-- escuela -->
                        <p:outputLabel
                            for="escuela"
                            value="#{bundle['escuela']}"/>
                        <h:panelGroup>
                            <h:outputText
                                value="#{coberturaController.selected.escuela.descripcionDependencia}"
                                rendered="#{!coberturaController.editable}"/>
                            <p:selectOneMenu 
                                id="escuela" 
                                value="#{coberturaController.selected.escuela}"
                                converter="unidadDependenciaConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="true"
                                rendered="#{coberturaController.editable}">
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{coberturaController.escuelas}" 
                                    var="escuela" 
                                    itemLabel="#{escuela.descripcionDependencia}" 
                                    itemValue="#{escuela}" />
                            </p:selectOneMenu>              
                            <p:message
                                for="escuela"/>
                        </h:panelGroup>
                        <!-- estrategia -->
                        <p:outputLabel
                            for="estrategia"
                            value="#{bundle['estrategia']}"/>
                        <h:panelGroup>
                            <h:outputText
                                value="#{coberturaController.selected.estrategia.nombre}"
                                rendered="#{!coberturaController.editable}"/>
                            <p:selectOneMenu 
                                id="estrategia" 
                                value="#{coberturaController.selected.estrategia}"
                                converter="dominioConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="true"
                                rendered="#{coberturaController.editable}">
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{coberturaController.estrategias}" 
                                    var="estrategia" 
                                    itemLabel="#{estrategia.nombre}" 
                                    itemValue="#{estrategia}" />
                            </p:selectOneMenu>              
                            <p:message
                                for="estrategia"/>
                        </h:panelGroup>
                        <!-- unidad -->
                        <p:outputLabel
                            for="unidades"
                            value="#{bundle['unidades']}"/>
                        <h:panelGroup>
                            <h:outputText
                                value="#{coberturaController.selected.unidad.descripcionDependencia}"
                                rendered="#{!coberturaController.editable}"/>
                            <!-- <p:selectManyMenu
                                 id="unidades" 
                                 value="#{coberturaController.unidadesSelected}"  
                                 filter="true"
                                 filterMatchMode="contains"
                                 showCheckbox="true" 
                                 converter="unidadDependenciaConverter"
                                 required="true"
                                 rendered="#{coberturaController.editable}">
                                 <p:ajax
                                     process="@this"
                                     update="unidadesSelected"/>
                                 <f:selectItems 
                                     value="#{coberturaController.unidades}" 
                                     var="unidad" 
                                     itemLabel="#{unidad.descripcionDependencia}" 
                                     itemValue="#{unidad}" />
                             </p:selectManyMenu> -->
                            <p:selectCheckboxMenu 
                                id="unidades" 
                                value="#{coberturaController.unidadesSelected}" 
                                label="#{bundle['unidades']}"
                                filter="true" 
                                filterMatchMode="contains"
                                converter="unidadDependenciaConverter"
                                required="true"
                                rendered="#{coberturaController.editable}">
                                <p:ajax
                                    process="@this"
                                    update="unidadesSelected"/>
                                <f:selectItems 
                                    value="#{coberturaController.unidades}" 
                                    var="unidad" 
                                    itemLabel="#{unidad.descripcionDependencia}" 
                                    itemValue="#{unidad}" />
                            </p:selectCheckboxMenu>
                            <p:dataList 
                                id="unidadesSelected"
                                value="#{coberturaController.unidadesSelected}" 
                                var="unidadSelected">
                                #{unidadSelected.descripcionDependencia}
                            </p:dataList>
                            <p:message
                                for="unidades"/>
                        </h:panelGroup>
                    </p:panelGrid>
                    <f:facet
                        name="footer">
                        <p:panelGrid
                            columns="12"
                            layout="grid" 
                            columnClasses="ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2" 
                            styleClass="ui-panelgrid-blank">
                            <p:commandButton 
                                value="#{bundle['commons.btn.save']}"
                                title="#{bundle['commons.btn.save']}"
                                icon="ui-icon-disk"
                                actionListener="#{coberturaController.onSave()}"
                                rendered="#{coberturaController.editable}"
                                process="@form"
                                update=":main"/>
                            <p:commandButton 
                                value="#{bundle['commons.btn.cancel']}"
                                title="#{bundle['commons.btn.cancel']}"
                                icon="ui-icon-circle-close"
                                actionListener="#{coberturaController.onCancel()}"
                                immediate="true"
                                rendered="#{coberturaController.editable}"
                                update=":main"/>
                        </p:panelGrid>
                    </f:facet>
                </p:panel>
            </h:form>
        </p:panel>
    </ui:define>
</ui:composition>