<!DOCTYPE html>
<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core"
    template="/templates/plantillaPrincipal.xhtml">
    <ui:define
        name="content">
        <p:panel 
            id="main"
            styleClass="ui-fluid">
            <h:form
                id="frmList"
                prependId="false"
                rendered="#{paeController.showList()}">
                <h:outputText 
                    value="#{bundle['pae.title']}"/>
                <p:separator/>
                <p:panel
                    id="pnlfiltro">
                    <p:panelGrid
                        layout="grid" 
                        columns="2"
                        columnClasses="ui-grid-col-2,ui-grid-col-10" 
                        styleClass="ui-panelgrid-blank">
                        <!-- vigencia -->
                        <p:outputLabel
                            id="fltvigencialbl"
                            for="fltvigencia"
                            value="#{bundle['vigencia']}"/>
                        <h:panelGroup>
                            <p:selectOneMenu 
                                id="fltvigencia" 
                                value="#{paeController.vigencia}" 
                                filter="true"
                                filterMatchMode="contains"
                                required="true">
                                <p:ajax 
                                    listener="#{paeController.onFindPAE()}" 
                                    update="pnlfiltrobtns fltvigencialbl fltvigencia fltvigenciamsg dtnovedades"/>
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{paeController.vigencias}" 
                                    var="vigencia" 
                                    itemLabel="#{vigencia}" 
                                    itemValue="#{vigencia}" />
                            </p:selectOneMenu>              
                            <p:message
                                id="fltvigenciamsg"
                                for="fltvigencia"/>
                        </h:panelGroup>
                    </p:panelGrid>
                    <f:facet
                        name="footer">
                        <p:panelGrid
                            id="pnlfiltrobtns"
                            columns="6"
                            layout="grid" 
                            columnClasses="ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2" 
                            styleClass="ui-panelgrid-blank">
                            <p:commandButton 
                                value="#{bundle['commons.btn.find']}"
                                title="#{bundle['commons.btn.find']}"
                                icon="ui-icon-search"
                                actionListener="#{paeController.onFindPAE()}"
                                process="@this pnlfiltro"
                                update=":main"/>
                            <p:commandButton 
                                id="btnadd"
                                value="#{bundle['commons.btn.add']}"
                                title="#{bundle['commons.btn.add']}"
                                icon="ui-icon-plus"
                                actionListener="#{paeController.onAddPAE()}"
                                update="main"
                                rendered="#{paeController.enableAddPAE()}"/>
                            <p:commandButton 
                                id="btnmodify"
                                value="#{bundle['commons.btn.modify']}"
                                title="#{bundle['commons.btn.modify']}"
                                icon="ui-icon-edit"
                                actionListener="#{paeController.onModifyPAE()}"
                                update="main"
                                rendered="#{paeController.enabledModify()}"/>
                            <p:commandButton 
                                id="btngenerate"
                                value="#{bundle['commons.btn.generate']}"
                                title="#{bundle['commons.btn.generate']}"
                                icon="ui-icon-gear"
                                actionListener="#{paeController.onGeneratePAE()}"
                                update="main"
                                rendered="#{paeController.enabledGenerate()}"/>
                        </p:panelGrid>
                    </f:facet>
                </p:panel>
                <p:dataTable 
                    id="dtnovedades"
                    widgetVar="dtlistwv"
                    value="#{paeController.pae.novedades}"
                    var="novedad"
                    paginator="true" 
                    rows="10"
                    reflow="true"
                    style="font-size: smaller"> 
                    <p:column 
                        headerText="#{bundle['pae.vigencia']}">
                        <h:outputText 
                            value="#{novedad.pae.vigencia}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['pae.estado']}">
                        <h:outputText 
                            value="#{novedad.pae.estado}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['pae.novedad.procedimiento']}">
                        <h:outputText 
                            value="#{novedad.procedimiento}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['pae.novedad.documento.tipo']}">
                        <h:outputText 
                            value="#{novedad.tipoDocumento.nombre}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['pae.novedad.documento.numero']}">
                        <h:outputText 
                            value="#{novedad.numeroDocumento}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['pae.novedad.documento.fecha']}">
                        <h:outputText 
                            value="#{novedad.fechaDocumento}">
                            <f:convertDateTime 
                                pattern="#{bundle['pattern.default.date']}"/>
                        </h:outputText>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['pae.novedad.observacion']}">
                        <h:outputText 
                            value="#{novedad.observacion}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['pae.novedad.documento']}">
                        <p:commandLink 
                            ajax="false" 
                            onclick="PrimeFaces.monitorDownload(start, stop);" 
                            title="#{bundle['commons.btn.download']}">
                            <h:outputText 
                                value="#{novedad.documento.nameWhitExtension}"/>
                            <p:fileDownload 
                                value="#{paeController.handleFileDownload(novedad.documento)}" />
                        </p:commandLink>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['pae.novedad.fecha']}">
                        <h:outputText 
                            value="#{novedad.fecha}">
                            <f:convertDateTime 
                                pattern="#{bundle['pattern.default.date']}"/>
                        </h:outputText>
                    </p:column>
                </p:dataTable>
            </h:form>
            <h:form
                id="frmDetail"
                prependId="false"
                enctype="multipart/form-data"
                rendered="#{paeController.showDetails()}">
                <h:outputText 
                    value="#{bundle['pae']}"
                    styleClass="toolbar-title"/>
                <p:separator/>
                <p:panel
                    id="pnlDetails">
                    <p:panelGrid
                        layout="grid" 
                        columns="4"
                        columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4" 
                        styleClass="ui-panelgrid-blank">
                        <!-- vigencia -->
                        <p:outputLabel
                            for="vigencia"
                            value="#{bundle['pae.vigencia']}"/>
                        <h:panelGroup>
                            <h:outputText
                                id="vigencia"
                                value="#{paeController.novedad.pae.vigencia}"/>
                        </h:panelGroup>
                        <!-- tipoDocumento -->
                        <p:outputLabel
                            id="tipoDocumentolbl"
                            for="tipoDocumento"
                            value="#{bundle['pae.novedad.documento.tipo']}"/>
                        <h:panelGroup>
                            <p:selectOneMenu 
                                id="tipoDocumento" 
                                value="#{paeController.novedad.tipoDocumento}"
                                converter="dominioConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="true">
                                <p:ajax
                                    process="@this"
                                    update="tipoDocumentolbl, tipoDocumento, tipoDocumentomsg"/>
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{paeController.tipoDocumentos}" 
                                    var="tipoDocumento" 
                                    itemLabel="#{tipoDocumento.nombre}" 
                                    itemValue="#{tipoDocumento}" />
                            </p:selectOneMenu>              
                            <p:message
                                id="tipoDocumentomsg"
                                for="tipoDocumento"/>
                        </h:panelGroup>
                        <!-- numeroDocumento -->
                        <p:outputLabel
                            id="numeroDocumentolbl"
                            for="numeroDocumento"
                            value="#{bundle['pae.novedad.documento.numero']}"/>
                        <h:panelGroup>
                            <p:inputText 
                                id="numeroDocumento" 
                                value="#{paeController.novedad.numeroDocumento}"
                                required="true"
                                maxlength="30">
                                <p:ajax
                                    process="@this"
                                    update="numeroDocumentolbl, numeroDocumento, numeroDocumentomsg"/>
                            </p:inputText>              
                            <p:message
                                id="numeroDocumentomsg"
                                for="numeroDocumento"/>
                        </h:panelGroup>
                        <!-- fechaDocumento -->
                        <p:outputLabel
                            id="fechaDocumentolbl"
                            for="fechaDocumento"
                            value="#{bundle['pae.novedad.documento.fecha']}"/>
                        <h:panelGroup>
                            <p:calendar 
                                id="fechaDocumento" 
                                value="#{paeController.novedad.fechaDocumento}"
                                pattern="#{bundle['pattern.default.date']}"
                                readonlyInput="true"
                                required="true"
                                maxdate="#{paeController.sysdate}">
                                <p:ajax
                                    event="dateSelect"
                                    update="fechaDocumentolbl, fechaDocumento, fechaDocumentomsg"/>
                            </p:calendar>              
                            <p:message
                                id="fechaDocumentomsg"
                                for="fechaDocumento"/>
                        </h:panelGroup>
                        <!-- documento -->
                        <p:outputLabel
                            id="documentolbl"
                            for="documento"
                            value="#{bundle['pae.novedad.documento']}"/>
                        <h:panelGroup
                            id="documentopnl">
                            <p:fileUpload 
                                id="documento"
                                fileUploadListener="#{paeController.handleFileUpload}" 
                                mode="advanced"
                                auto="true" 
                                required="true"
                                allowTypes="/(\.|\/)(pdf)$/"
                                update="documentolbl documentopnl"/>
                            <h:outputText
                                id="documentonombre"
                                value="#{paeController.novedad.documento.nameWhitExtension}"/>
                            <p:message
                                id="documentomsg"
                                for="documento"/>
                        </h:panelGroup>
                        <!-- observacion -->
                        <p:outputLabel
                            for="observacion"
                            value="#{bundle['pae.novedad.observacion']}"/>
                        <h:panelGroup>
                            <p:inputTextarea 
                                id="observacion" 
                                value="#{paeController.novedad.observacion}"
                                required="false"
                                maxlength="1000"
                                rows="4"/>              
                            <p:message
                                for="observacion"/>
                        </h:panelGroup>
                    </p:panelGrid>
                    <f:facet
                        name="footer">
                        <p:panelGrid
                            columns="12"
                            layout="grid" 
                            columnClasses="ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2" 
                            styleClass="ui-panelgrid-blank">
                            <p:commandButton 
                                value="#{bundle['commons.btn.save']}"
                                title="#{bundle['commons.btn.save']}"
                                icon="ui-icon-disk"
                                actionListener="#{paeController.onSave()}"
                                process="@form"
                                update=":main"/>
                            <p:commandButton 
                                value="#{bundle['commons.btn.cancel']}"
                                title="#{bundle['commons.btn.cancel']}"
                                icon="ui-icon-circle-close"
                                actionListener="#{paeController.onCancel()}"
                                immediate="true"
                                update=":main"/>
                        </p:panelGrid>
                    </f:facet>
                </p:panel>
            </h:form>
        </p:panel>
    </ui:define>
</ui:composition>