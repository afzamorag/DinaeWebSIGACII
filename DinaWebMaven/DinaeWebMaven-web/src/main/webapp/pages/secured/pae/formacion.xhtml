<!DOCTYPE html>
<ui:composition 
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:p="http://primefaces.org/ui"
  template="/templates/plantillaPrincipal.xhtml">
  <ui:define
    name="content">
    <p:panel 
      id="main"
      styleClass="ui-fluid">
      <h:form
        id="frmDetail"
        prependId="false">
        <h:outputText 
          value="#{bundle['formacion.title.detail']}"/>
        <p:separator />
        <p:panel
          id="pnlDetails">
          <p:panelGrid
            columns="2"
            layout="grid" 
            columnClasses="ui-grid-col-2,ui-grid-col-10" 
            styleClass="ui-panelgrid-blank">
            <!-- nivelacademico -->
            <p:outputLabel
              for="nivelacademico"
              value="#{bundle['nivelacademico']}"/>
            <h:panelGroup>
              <h:outputText
                id="nivelacademico"
                value="#{formacionController.selected.carrera.nivelAcademico.descripcion}"/>
              <p:message
                for="nivelacademico"/>
            </h:panelGroup>
            <!-- carrera -->
            <p:outputLabel
              for="carrera"
              value="#{bundle['formacion.carrera']}"/>
            <h:panelGroup>
              <h:outputText
                id="carrera"
                value="#{formacionController.selected.carrera.descripcion}"/>
              <p:message
                for="carrera"/>
            </h:panelGroup>
            <!-- proceso -->
            <p:outputLabel
              for="proceso"
              value="#{bundle['formacion.proceso']}"/>
            <h:panelGroup>
              <h:outputText
                id="proceso"
                value="#{formacionController.selected.proceso.nombre}"/>
              <p:message
                for="proceso"/>
            </h:panelGroup>
            <!-- necesidad -->
            <p:outputLabel
              for="necesidad"
              value="#{bundle['formacion.necesidad']}"/>
            <h:panelGroup>
              <h:outputText
                id="necesidad"
                value="#{formacionController.selected.necesidad}"/>
              <p:message
                for="necesidad"/>
            </h:panelGroup>
            <!-- estado -->
            <p:outputLabel
              for="estado"
              value="#{bundle['formacion.estado']}"/>
            <h:panelGroup>
              <h:outputText
                id="estado"
                value="#{formacionController.selected.estado}"/>
              <p:message
                for="estado"/>
            </h:panelGroup>
            <!-- escuelas -->
            <p:outputLabel
              for="escuelas"
              value="#{bundle['escuelas']}"/>
            <h:panelGroup>         
              <p:panelGrid
                columns="1"
                layout="grid" 
                columnClasses="ui-grid-col-3" 
                styleClass="ui-panelgrid-blank">
                <p:commandButton 
                  value="#{bundle['formacion.btn.admin.escuelas']}"
                  title="#{bundle['formacion.btn.admin.escuelas']}"
                  icon="ui-icon-plus"
                  actionListener="#{formacionController.onAdminEscuelas()}"
                  rendered="#{formacionController.enableAdminEscuelas()}"
                  update="dlgasociarescuelas"/>
              </p:panelGrid>     
              <p:dataList 
                id="escuelas" 
                rowIndexVar="row"
                var="escuela" 
                value="#{formacionController.selected.escuelas}"
                type="definition"
                style="border: none !important;">
                <p:fieldset
                  id="pnlescuela"
                  legend="#{escuela.escuela.descripcionDependencia}"
                  collapsed="true"
                  toggleable="true">
                  <h:outputText 
                    value="#{bundle['formacion.lbl.cohortes']}"/>
                  <p:separator />
                  <p:panelGrid
                    columns="4"
                    layout="grid" 
                    columnClasses="ui-grid-col-3,ui-grid-col-3,ui-grid-col-3,ui-grid-col-3" 
                    styleClass="ui-panelgrid-blank">
                    <p:commandButton 
                      value="#{bundle['formacion.btn.cohorte.add']}" 
                      title="#{bundle['formacion.btn.cohorte.add']}"
                      actionListener="#{formacionController.onCreateCohorte(escuela)}"
                      rendered="#{formacionController.enableCreateCohorte()}"
                      update="dlgcohorte"/>
                  </p:panelGrid>
                  <p:dataTable 
                    id="dtcohortes"
                    value="#{escuela.cohortes}"
                    var="cohorte"
                    reflow="true"
                    emptyMessage="#{bundle['formacion.msg.cohortes.empty']}"> 
                    <p:column 
                      headerText="#{bundle['cohorte.consecutivo']}"
                      sortBy="#{cohorte.consecutivo}">
                      <h:outputText 
                        value="#{cohorte.consecutivo}">
                      </h:outputText>
                    </p:column>
                    <p:column 
                      headerText="#{bundle['cohorte.fecha.inicial']}"
                      sortBy="#{cohorte.fechaInicial}">
                      <h:outputText 
                        value="#{cohorte.fechaInicial}">
                        <f:convertDateTime 
                          pattern="#{bundle['pattern.default.date']}"/>
                      </h:outputText>
                    </p:column>
                    <p:column 
                      headerText="#{bundle['cohorte.fecha.final']}"
                      sortBy="#{cohorte.fechaFinal}">
                      <h:outputText 
                        value="#{cohorte.fechaFinal}">
                        <f:convertDateTime 
                          pattern="#{bundle['pattern.default.date']}"/>
                      </h:outputText>
                    </p:column>
                    <p:column 
                      headerText="#{bundle['cohorte.numero.estudiantes']}"
                      sortBy="#{cohorte.numeroEstudiantes}">
                      <h:outputText 
                        value="#{cohorte.numeroEstudiantes}">
                      </h:outputText>
                    </p:column>
                    <p:column 
                      headerText="#{bundle['modalidad']}"
                      sortBy="#{cohorte.modalidad.nomber}">
                      <h:outputText 
                        value="#{cohorte.modalidad.nombre}">
                      </h:outputText>
                    </p:column>
                    <p:column 
                      style="width:25px;text-align:center">
                      <p:commandButton 
                        title="#{bundle['formacion.btn.cohorte.edit']}"
                        icon="ui-icon-pencil"
                        actionListener="#{formacionController.onEditCohorte(cohorte)}"
                        update="dlgcohorte"
                        rendered="#{formacionController.enableEditCohorte()}"/>
                    </p:column>
                    <p:column 
                      style="width:25px;text-align:center">
                      <p:commandButton 
                        title="#{bundle['formacion.btn.cohorte.remove']}"
                        icon="ui-icon-trash"
                        immediate="true"
                        actionListener="#{formacionController.onDeleteCohorte(cohorte)}"
                        rendered="#{formacionController.enableDeleteCohorte()}"
                        update="escuelas:#{row}:pnlescuela">
                        <p:confirm 
                          header="#{bundle['commons.cfmdlg.header']}" 
                          message="#{bundle['commons.cfmdlg.remove.message']}" 
                          icon="ui-icon-alert" />
                      </p:commandButton>
                    </p:column>
                  </p:dataTable>
                </p:fieldset>
              </p:dataList>
            </h:panelGroup>
          </p:panelGrid>
          <f:facet
            name="footer">
            <p:panelGrid
              columns="12"
              layout="grid" 
              columnClasses="ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2" 
              styleClass="ui-panelgrid-blank">
              <p:commandButton 
                value="#{bundle['commons.btn.edit']}"
                title="#{bundle['commons.btn.edit']}"
                icon="ui-icon-pencil"
                actionListener="#{formacionController.onEdit()}"
                rendered="#{formacionController.enableEdit()}"
                update=":frmDetail"/>
              <p:commandButton 
                value="#{bundle['commons.btn.approve']}"
                title="#{bundle['commons.btn.approve']}"
                icon="ui-icon-pencil"
                actionListener="#{formacionController.onApprove()}"
                rendered="#{formacionController.enableApprove()}"
                update=":frmDetail"/>
              <p:commandButton 
                value="#{bundle['commons.btn.approve']}"
                title="#{bundle['commons.btn.approve']}"
                icon="ui-icon-pencil"
                actionListener="#{formacionController.onSaveApprove()}"
                rendered="#{formacionController.enableSaveApprove()}"
                update=":frmDetail"/>
              <p:commandButton 
                value="#{bundle['commons.btn.reprobate']}"
                title="#{bundle['commons.btn.reprobate']}"
                icon="ui-icon-pencil"
                actionListener="#{formacionController.onReprobate()}"
                rendered="#{formacionController.enableReprobate()}"
                update=":frmDetail">
                <p:confirm 
                  header="#{bundle['commons.cfmdlg.header']}" 
                  message="#{bundle['commons.msg.reprobate']}" 
                  icon="ui-icon-alert" />
              </p:commandButton>
              <p:commandButton 
                value="#{bundle['commons.btn.back']}"
                title="#{bundle['commons.btn.back']}"
                icon="ui-icon-arrowreturn-1-w"
                action="#{formacionController.onBack()}"/>
            </p:panelGrid>
          </f:facet>
        </p:panel>
      </h:form>
    </p:panel>
    <div>
      <p:dialog 
        id="dlgasociarescuelas" 
        visible="#{formacionController.showFormAssociateEscuelas}"
        modal="true"
        width="50%"
        height="30%"
        closable="false"
        closeOnEscape="false"
        resizable="false"
        draggable="false"
        responsive="true" 
        position="center">
        <h:form
          id="frmasociarescuelas"
          prependId="false">
          <h:outputText 
            value="#{bundle['cohorte']}"/>
          <p:separator />
          <p:messages
            globalOnly="true"
            showDetail="false"/>
          <p:panel
            id="pnlasociarescuelas">
            <h:panelGroup>
              <p:pickList 
                id="escuelasSeleccionables" 
                value="#{formacionController.escuelas}" 
                var="escuelaSeleccionable" 
                itemLabel="#{escuelaSeleccionable.descripcionDependencia}" 
                itemValue="#{escuelaSeleccionable}" 
                responsive="true"
                showSourceFilter="true" 
                showTargetFilter="true" 
                filterMatchMode="contains" 
                converter="unidadDependenciaConverter"/>
            </h:panelGroup>
            <f:facet
              name="footer">
              <p:panelGrid
                columns="3"
                layout="grid" 
                columnClasses="ui-grid-col-4,ui-grid-col-4,ui-grid-col-4" 
                styleClass="ui-panelgrid-blank">
                <p:commandButton 
                  value="#{bundle['commons.btn.save']}"
                  title="#{bundle['commons.btn.save']}"
                  icon="ui-icon-disk"
                  actionListener="#{formacionController.onSaveAdminEscuelas()}"
                  process="frmasociarescuelas"
                  update="dlgasociarescuelas,escuelas"/>
                <p:commandButton 
                  value="#{bundle['commons.btn.cancel']}"
                  title="#{bundle['commons.btn.cancel']}"
                  icon="ui-icon-circle-close"
                  actionListener="#{formacionController.onCancelSaveAdminEscuelas()}"
                  immediate="true"
                  update="dlgasociarescuelas">
                  <p:resetInput 
                    target="frmasociarescuelas" />
                </p:commandButton>
              </p:panelGrid>
            </f:facet>
          </p:panel>
        </h:form>
      </p:dialog>
    </div>
    <div>
      <p:dialog 
        id="dlgcohorte" 
        visible="#{formacionController.showFormCohorte}"
        modal="true"
        position="top"
        width="600"
        closable="false"
        closeOnEscape="false"
        resizable="false"
        responsive="true" 
        draggable="true">
        <h:form
          id="frmcohorte"
          prependId="false">
          <h:outputText 
            value="#{bundle['cohorte']}"/>
          <p:separator />
          <p:messages
            globalOnly="true"
            showDetail="false"/>
          <p:panel
            id="pnlcohorte">
            <p:panelGrid
              columns="2"
              layout="grid"  
              columnClasses="ui-grid-col-4,ui-grid-col-8" 
              styleClass="ui-panelgrid-blank">
              <!--consecutivo--> 
              <p:outputLabel
                for="consecutivo"
                value="#{bundle['cohorte.consecutivo']}"/>
              <h:panelGroup>
                <p:inputText
                  id="consecutivo"
                  value="#{formacionController.cohorteSelected.consecutivo}"
                  required="true">
                </p:inputText>
                <p:message
                  for="consecutivo"/>
              </h:panelGroup>
              <!--fechaInicial--> 
              <p:outputLabel
                id="fechaIniciallbl"
                for="fechaInicial"
                value="#{bundle['cohorte.fecha.inicial']}"/>
              <h:panelGroup>
                <p:calendar 
                  id="fechaInicial" 
                  value="#{formacionController.cohorteSelected.fechaInicial}"
                  pattern="#{bundle['pattern.default.date']}"
                  readonlyInput="true"
                  label="#{bundle['cohorte.fecha.inicial']}"
                  required="true"
                  maxdate="#{formacionController.cohorteSelected.fechaFinal}"
                  validator="fechaInicialValidador"
                  validatorMessage="#{bundle['commons.msg.error.validation.date.initial']}" >              
                  <p:ajax 
                    event="dateSelect" 
                    update="fechaIniciallbl fechaInicial fechaInicialmsg fechaFinallbl fechaFinal fechaFinalmsg"/>
                  <f:attribute 
                    name="fechaFinal" 
                    value="#{formacionController.cohorteSelected.fechaFinal}"/>
                </p:calendar>
                <p:message
                  id="fechaInicialmsg"
                  for="fechaInicial"/>
              </h:panelGroup>
              <!--fechaFinal--> 
              <p:outputLabel
                id="fechaFinallbl"
                for="fechaFinal"
                value="#{bundle['cohorte.fecha.final']}"/>
              <h:panelGroup>
                <p:calendar 
                  id="fechaFinal" 
                  value="#{formacionController.cohorteSelected.fechaFinal}"
                  pattern="#{bundle['pattern.default.date']}"
                  readonlyInput="true"
                  label="#{bundle['cohorte.fecha.final']}"
                  required="true"
                  mindate="#{formacionController.cohorteSelected.fechaInicial}" 
                  validator="fechaFinalValidador"
                  validatorMessage="#{bundle['commons.msg.error.validation.date.final']}" >              
                  <p:ajax 
                    event="dateSelect" 
                    update="fechaIniciallbl fechaInicial fechaInicialmsg fechaFinallbl fechaFinal fechaFinalmsg"/>
                  <f:attribute 
                    name="fechaInicial" 
                    value="#{formacionController.cohorteSelected.fechaInicial}"/>
                </p:calendar>              
                <p:message
                  id="fechaFinalmsg"
                  for="fechaFinal"/>
              </h:panelGroup>
              <!--numeroEstudiantes--> 
              <p:outputLabel
                for="numeroEstudiantes"
                value="#{bundle['cohorte.numero.estudiantes']}"/>
              <h:panelGroup>
                <p:inputText
                  id="numeroEstudiantes"
                  value="#{formacionController.cohorteSelected.numeroEstudiantes}"
                  required="true"
                  maxlength="4">  
                  <f:validateLongRange
                    minimum="1"/>
                </p:inputText>
                <p:message
                  for="numeroEstudiantes"/>
              </h:panelGroup>
              <!--modalidad--> 
              <p:outputLabel
                id="modalidadlbl"
                for="modalidad"
                value="#{bundle['modalidad']}"/>
              <h:panelGroup>
                <p:selectOneMenu 
                  id="modalidad" 
                  value="#{formacionController.cohorteSelected.modalidad}"
                  converter="dominioConverter"
                  required="true">
                  <f:selectItem 
                    noSelectionOption="true"/>
                  <f:selectItems 
                    value="#{appController.modalidades}" 
                    var="modalidad" 
                    itemLabel="#{modalidad.nombre}" 
                    itemValue="#{modalidad}" />
                </p:selectOneMenu>              
                <p:message  
                  id="modalidadmsg"
                  for="modalidad"/>
              </h:panelGroup>
            </p:panelGrid>
            <f:facet
              name="footer">
              <p:panelGrid
                columns="3"
                layout="grid" 
                columnClasses="ui-grid-col-4,ui-grid-col-4,ui-grid-col-4" 
                styleClass="ui-panelgrid-blank">
                <p:commandButton 
                  value="#{bundle['commons.btn.save']}"
                  title="#{bundle['commons.btn.save']}"
                  icon="ui-icon-disk"
                  actionListener="#{formacionController.onSaveCohorte()}"
                  process="frmcohorte"
                  update="dlgcohorte,escuelas"/>
                <p:commandButton 
                  value="#{bundle['commons.btn.cancel']}"
                  title="#{bundle['commons.btn.cancel']}"
                  icon="ui-icon-circle-close"
                  actionListener="#{formacionController.onCancelSaveCohorte()}"
                  immediate="true"
                  update="dlgcohorte">
                  <p:resetInput 
                    target="frmcohorte" />
                </p:commandButton>
              </p:panelGrid>
            </f:facet>
          </p:panel>
        </h:form>
      </p:dialog>
    </div>
  </ui:define>
</ui:composition>