<!DOCTYPE html>
<ui:composition 
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    template="/templates/plantillaPrincipal.xhtml">
    <ui:define
        name="content">
        <p:panel 
            id="main"
            styleClass="ui-fluid">
            <h:form
                id="frmlist"
                prependId="false"
                rendered="#{necesidadController.showList}">
                <h:outputText 
                    value="#{bundle['necesidad.title.list']}"/>
                <p:separator />
                <p:panel
                    id="pnlfiltro">
                    <p:panelGrid
                        layout="grid" 
                        columns="2"
                        columnClasses="ui-grid-col-2,ui-grid-col-10" 
                        styleClass="ui-panelgrid-blank">
                        <!-- vigencia -->
                        <p:outputLabel
                            id="fltvigencialbl"
                            for="fltvigencia"
                            value="#{bundle['vigencia']}"/>
                        <h:panelGroup>
                            <p:selectOneMenu 
                                id="fltvigencia" 
                                value="#{necesidadController.filtro.pae}" 
                                converter="paeConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="true">
                                <p:ajax
                                    process="@this"
                                    listener="#{necesidadController.onLoadList()}"
                                    update="pnlfiltrobtns fltvigencialbl fltvigencia fltvigenciamsg dtlist"/>
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{necesidadController.vigencias}" 
                                    var="vigencia" 
                                    itemLabel="#{vigencia.vigencia}" 
                                    itemValue="#{vigencia}" />
                            </p:selectOneMenu>              
                            <p:message
                                id="fltvigenciamsg"
                                for="fltvigencia"/>
                        </h:panelGroup>
                    </p:panelGrid>
                    <f:facet
                        name="footer">
                        <p:panelGrid
                            id="pnlfiltrobtns"
                            columns="12"
                            layout="grid" 
                            columnClasses="ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2" 
                            styleClass="ui-panelgrid-blank">
                            <p:commandButton 
                                id="btnfind"
                                value="#{bundle['commons.btn.find']}"
                                title="#{bundle['commons.btn.find']}"
                                icon="ui-icon-search"
                                actionListener="#{necesidadController.onLoadList()}"
                                process="@this pnlfiltro"
                                update="frmlist"
                                style="border: none"/>
                            <p:commandButton 
                                id="btnCreate" 
                                value="#{bundle['commons.btn.new']}"
                                title="#{bundle['commons.btn.new']}"
                                icon="ui-icon-document"
                                actionListener="#{necesidadController.onCreate()}"
                                rendered="#{necesidadController.enableCreate()}"
                                update=":main"
                                style="border: none"/>
                            <p:commandButton 
                                id="btnimport" 
                                value="#{bundle['commons.btn.import']}"
                                title="#{bundle['cobertura.btn.importar.necesidades.ditah']}"
                                icon="ui-icon-document"
                                actionListener="#{necesidadController.onImportNeeds()}"
                                rendered="#{necesidadController.enableImportNeeds()}"
                                update=":main"
                                style="border: none">
                                <p:confirm 
                                    header="#{bundle['commons.cfmdlg.header']}" 
                                    message="#{bundle['necesidad.msg.confirm.import.needs']}" 
                                    icon="ui-icon-alert" />
                            </p:commandButton>
                            <p:commandButton 
                                id="btnassociate" 
                                value="#{bundle['cobertura.btn.asociar.procesos']}"
                                title="#{bundle['cobertura.btn.asociar.procesos']}"
                                icon="ui-icon-document"
                                actionListener="#{necesidadController.onAssociateProcesses()}"
                                rendered="#{necesidadController.enableAssociateProcesses()}"
                                update=":main"
                                style="border: none"/>
                            <p:commandButton 
                                ajax="false" 
                                value="#{bundle['commons.btn.report']}"
                                style="border: none">                                 
                                <p:dataExporter 
                                    type="csv" 
                                    target="dtlist" 
                                    fileName="#{bundle['capacitacion.necesidad']}" />
                            </p:commandButton> 
                        </p:panelGrid>
                    </f:facet>
                </p:panel>
                <p:dataTable 
                    id="dtlist"
                    value="#{necesidadController.list}"
                    var="record"
                    paginator="true" 
                    rows="10"
                    paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                    rowsPerPageTemplate="10,50,100"
                    selectionMode="single" 
                    selection="#{necesidadController.selected}" 
                    rowKey="#{record.id}"
                    reflow="true"
                    style="font-size: x-small"> 
                    <p:ajax 
                        event="rowSelect" 
                        listener="#{necesidadController.onRowSelect}" 
                        update=":main" />
                    <p:column 
                        headerText="#{bundle['necesidad.id']}"
                        filterBy="#{record.id}"
                        filterMatchMode="contains"
                        sortBy="#{record.id}">
                        <h:outputText 
                            value="#{record.id}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['necesidad.region']}"
                        filterBy="#{record.region.descripcion}"
                        filterMatchMode="contains"
                        sortBy="#{record.region.descripcion}">
                        <h:outputText 
                            value="#{record.region.descripcion}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['necesidad.unidad.fisica']}"
                        filterBy="#{record.unidadFisica.descripcionDependencia}"
                        filterMatchMode="contains"
                        sortBy="#{record.unidadFisica.descripcionDependencia}">
                        <h:outputText 
                            value="#{record.unidadFisica.descripcionDependencia}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['necesidad.unidad.dependencia']}"
                        filterBy="#{record.unidadDependencia.descripcionDependencia}"
                        filterMatchMode="contains"
                        sortBy="#{record.unidadDependencia.descripcionDependencia}">
                        <h:outputText 
                            value="#{record.unidadDependencia.descripcionDependencia}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['necesidad.carrera']}"
                        filterBy="#{record.carrera.titulo}"
                        filterMatchMode="contains"
                        sortBy="#{record.carrera.titulo}">
                        <h:outputText 
                            value="#{record.carrera.descripcion}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['necesidad.proceso']}"
                        filterBy="#{record.proceso.nombre}"
                        filterMatchMode="contains"
                        sortBy="#{record.proceso.nombre}">
                        <h:outputText 
                            value="#{record.proceso.nombre}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['necesidad.estrategia']}"
                        filterBy="#{record.estrategia.nombre}"
                        filterMatchMode="contains"
                        sortBy="#{record.estrategia.nombre}">
                        <h:outputText 
                            value="#{record.estrategia.nombre}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['necesidad.origen']}"
                        filterBy="#{record.origen}"
                        filterMatchMode="contains"
                        sortBy="#{record.origen}">
                        <h:outputText 
                            value="#{record.origen}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['necesidad.numero']}"
                        filterBy="#{record.numero}"
                        filterMatchMode="contains"
                        sortBy="#{record.numero}">
                        <h:outputText 
                            value="#{record.numero}"/>
                    </p:column>
                    <p:column 
                        headerText="#{bundle['necesidad.estado']}"
                        filterBy="#{record.estado}"
                        filterMatchMode="contains"
                        sortBy="#{record.estado}">
                        <h:outputText 
                            value="#{record.estado}"/>
                    </p:column>
                </p:dataTable>
            </h:form>
            <h:form
                id="frmDetail"
                prependId="false"
                rendered="#{necesidadController.showDetails}">
                <h:outputText 
                    value="#{bundle['necesidad.title.detail']}"/>
                <p:separator />
                <p:panel
                    id="pnlDetails">
                    <p:panelGrid
                        columns="2"
                        layout="grid" 
                        columnClasses="ui-grid-col-2,ui-grid-col-10" 
                        styleClass="ui-panelgrid-blank">
                        <!-- vigencia -->
                        <p:outputLabel
                            for="vigencia"
                            value="#{bundle['vigencia']}"/>
                        <h:panelGroup>
                            <h:outputText
                                value="#{necesidadController.selected.novedad.pae.vigencia}"
                                rendered="#{!necesidadController.editable}"/>
                            <p:selectOneMenu 
                                id="vigencia" 
                                value="#{necesidadController.selected.pae}"
                                converter="paeConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="true"
                                rendered="#{necesidadController.editable}">
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{necesidadController.vigencias}" 
                                    var="vigencia" 
                                    itemLabel="#{vigencia.vigencia}" 
                                    itemValue="#{vigencia}" />
                            </p:selectOneMenu>              
                            <p:message
                                for="vigencia"/>
                        </h:panelGroup>
                        <!-- region -->
                        <p:outputLabel
                            for="region"
                            value="#{bundle['region']}"/>
                        <h:panelGroup>
                            <h:outputText
                                value="#{necesidadController.selected.region.descripcion}"
                                rendered="#{!necesidadController.editable}"/>
                            <p:selectOneMenu 
                                id="region" 
                                value="#{necesidadController.selected.region}"
                                converter="regionalesConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="true"
                                rendered="#{necesidadController.editable}">
                                <p:ajax 
                                    process="@this" 
                                    listener="#{necesidadController.loadUnidadesFisicas()}"
                                    update="unidadFisica"/>
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{necesidadController.regiones}" 
                                    var="region" 
                                    itemLabel="#{region.descripcion}" 
                                    itemValue="#{region}" />
                            </p:selectOneMenu>              
                            <p:message
                                for="region"/>
                        </h:panelGroup>
                        <!-- unidadFisica -->
                        <p:outputLabel
                            for="unidadFisica"
                            value="#{bundle['unidad.fisica']}"/>
                        <h:panelGroup>
                            <h:outputText
                                value="#{necesidadController.selected.unidadFisica.descripcionDependencia}"
                                rendered="#{!necesidadController.editable}"/>
                            <p:selectOneMenu 
                                id="unidadFisica" 
                                value="#{necesidadController.selected.unidadFisica}"
                                converter="unidadDependenciaConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="true"
                                rendered="#{necesidadController.editable}">
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{necesidadController.unidadesFisicas}" 
                                    var="unidadFisica" 
                                    itemLabel="#{unidadFisica.descripcionDependencia}" 
                                    itemValue="#{unidadFisica}" />
                            </p:selectOneMenu>              
                            <p:message
                                for="unidadFisica"/>
                        </h:panelGroup>
                        <!-- unidadDependencia -->
                        <p:outputLabel
                            for="unidadDependencia"
                            value="#{bundle['unidad.dependencia']}"/>
                        <h:panelGroup>
                            <h:outputText
                                value="#{necesidadController.selected.unidadDependencia.descripcionDependencia}"
                                rendered="#{!necesidadController.editable}"/>
                            <p:selectOneMenu 
                                id="unidadDependencia" 
                                value="#{necesidadController.selected.unidadDependencia}"
                                converter="unidadDependenciaConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="true"
                                rendered="#{necesidadController.editable}">
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{necesidadController.unidadesDependencias}" 
                                    var="unidadDependencia" 
                                    itemLabel="#{unidadDependencia.descripcionDependencia}" 
                                    itemValue="#{unidadDependencia}" />
                            </p:selectOneMenu>              
                            <p:message
                                for="unidadDependencia"/>
                        </h:panelGroup>
                        <!-- nivelAcademico -->
                        <p:outputLabel
                            for="nivelAcademico"
                            value="#{bundle['nivelacademico']}"/>
                        <h:panelGroup>
                            <h:outputText
                                value="#{necesidadController.selected.carrera.nivelAcademico.descripcion}"
                                rendered="#{!necesidadController.editable}"/>
                            <p:selectOneMenu 
                                id="nivelAcademico" 
                                value="#{necesidadController.selected.carrera.nivelAcademico}"
                                converter="nivelAcademicoConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="true"
                                rendered="#{necesidadController.editable}">
                                <p:ajax 
                                    process="@this" 
                                    listener="#{necesidadController.loadCarreras()}"
                                    update="carrera"/>
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{necesidadController.nivelesAcademicos}" 
                                    var="nivelAcademico" 
                                    itemLabel="#{nivelAcademico.descripcion}" 
                                    itemValue="#{nivelAcademico}" />
                            </p:selectOneMenu>              
                            <p:message  
                                for="nivelAcademico"/>
                        </h:panelGroup>
                        <!-- carrera -->
                        <p:outputLabel
                            for="carrera"
                            value="#{bundle['carrera']}"/>
                        <h:panelGroup>
                            <h:outputText
                                value="#{necesidadController.selected.carrera.titulo}"
                                rendered="#{!necesidadController.editable}"/>
                            <p:selectOneMenu 
                                id="carrera" 
                                value="#{necesidadController.selected.carrera}"
                                converter="carreraConverter"
                                filter="true"
                                filterMatchMode="contains"
                                required="true"
                                rendered="#{necesidadController.editable}">
                                <f:selectItem 
                                    noSelectionOption="true"/>
                                <f:selectItems 
                                    value="#{necesidadController.programas}" 
                                    var="carrera" 
                                    itemLabel="#{carrera.descripcion}" 
                                    itemValue="#{carrera}" />
                            </p:selectOneMenu>              
                            <p:message  
                                for="carrera"/>
                        </h:panelGroup>
                        <!-- numero -->
                        <p:outputLabel
                            for="numero"
                            value="#{bundle['necesidad.numero']}"/>
                        <h:panelGroup>
                            <h:outputText
                                value="#{necesidadController.selected.numero}"
                                rendered="#{!necesidadController.editable}"/>
                            <p:inputText
                                id="numero"
                                value="#{necesidadController.selected.numero}"
                                required="true"
                                rendered="#{necesidadController.editable}">
                                <f:validateLongRange
                                    minimum="1"/>
                            </p:inputText>
                            <p:message
                                for="numero"/>
                        </h:panelGroup>
                        <!-- estado -->
                        <p:outputLabel
                            for="estado"
                            value="#{bundle['necesidad.estado']}"
                            rendered="#{!necesidadController.newRecord}"/>
                        <h:panelGroup
                            rendered="#{!necesidadController.newRecord}">
                            <h:outputText
                                id="estado"
                                value="#{necesidadController.selected.estado}"/>
                            <p:message
                                for="estado"/>
                        </h:panelGroup>
                    </p:panelGrid>
                    <f:facet
                        name="footer">
                        <p:panelGrid
                            columns="12"
                            layout="grid" 
                            columnClasses="ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2" 
                            styleClass="ui-panelgrid-blank">
                            <p:commandButton 
                                value="#{bundle['commons.btn.edit']}"
                                title="#{bundle['commons.btn.edit']}"
                                icon="ui-icon-pencil"
                                actionListener="#{necesidadController.onEdit()}"
                                rendered="#{!necesidadController.editable}"
                                update=":frmDetail"/>
                            <p:commandButton 
                                value="#{bundle['commons.btn.save']}"
                                title="#{bundle['commons.btn.save']}"
                                icon="ui-icon-disk"
                                actionListener="#{necesidadController.onSave()}"
                                rendered="#{necesidadController.editable}"
                                process="@form"
                                update=":frmDetail"/>
                            <p:commandButton 
                                value="#{bundle['commons.btn.cancel']}"
                                title="#{bundle['commons.btn.cancel']}"
                                icon="ui-icon-circle-close"
                                actionListener="#{necesidadController.onCancel()}"
                                immediate="true"
                                rendered="#{necesidadController.editable}"
                                update=":main"/>
                            <p:commandButton 
                                value="#{bundle['commons.btn.remove']}"
                                title="#{bundle['commons.btn.remove']}"
                                icon="ui-icon-trash"
                                actionListener="#{necesidadController.onDelete()}"
                                immediate="true"
                                rendered="#{necesidadController.enableDelete()}"
                                update=":main">
                                <p:confirm 
                                    header="#{bundle['commons.cfmdlg.header']}" 
                                    message="#{bundle['commons.cfmdlg.remove.message']}" 
                                    icon="ui-icon-alert" />
                            </p:commandButton>
                            <p:commandButton 
                                value="#{bundle['commons.btn.back']}"
                                title="#{bundle['commons.btn.back']}"
                                icon="ui-icon-arrowreturn-1-w"
                                actionListener="#{necesidadController.onBackToList()}"
                                rendered="#{!necesidadController.editable}"
                                update=":main"/>
                        </p:panelGrid>
                    </f:facet>
                </p:panel>
            </h:form>
            <h:form
                id="frmAssociateProcesses"
                prependId="false"
                rendered="#{necesidadController.showAssociateProcesses}">
                <h:outputText 
                    value="#{bundle['necesidad.title.associate.processes']}"/>
                <p:separator />
                <p:panel>
                    <p:dataTable 
                        id="dtNecesidadesParciales"
                        value="#{necesidadController.necesidadesParciales}"
                        var="necesidadParcial"
                        reflow="true"> 
                        <p:column 
                            headerText="#{bundle['nivelacademico']}"
                            sortBy="#{necesidadParcial.programa.nivelAcademico.descripcion}">
                            <h:outputText 
                                value="#{necesidadParcial.programa.nivelAcademico.descripcion}"/>
                        </p:column>
                        <p:column 
                            headerText="#{bundle['necesidad.carrera']}"
                            sortBy="#{necesidadParcial.programa.descripcion}">
                            <h:outputText 
                                value="#{necesidadParcial.programa.descripcion}"/>
                        </p:column>
                        <p:column 
                            headerText="#{bundle['necesidad.proceso']}">
                            <h:panelGroup>
                                <p:selectOneMenu 
                                    id="proceso" 
                                    value="#{necesidadParcial.proceso}"
                                    converter="dominioConverter"
                                    filter="true"
                                    filterMatchMode="contains"
                                    label="#{bundle['necesidad.proceso']}"
                                    required="false">
                                    <p:ajax
                                        process="@this"
                                        update="proceso procesomsg estrategia estrategiamsg"/>
                                    <f:selectItem 
                                        noSelectionOption="true"/>
                                    <f:selectItems 
                                        value="#{necesidadController.procesos}" 
                                        var="proceso" 
                                        itemLabel="#{proceso.nombre}" 
                                        itemValue="#{proceso}" />
                                </p:selectOneMenu>              
                                <p:message  
                                    id="procesomsg"
                                    for="proceso"/>
                            </h:panelGroup>
                        </p:column>
                        <p:column 
                            headerText="#{bundle['necesidad.estrategia']}">
                            <h:panelGroup>
                                <p:selectOneMenu 
                                    id="estrategia" 
                                    value="#{necesidadParcial.estrategia}"
                                    converter="dominioConverter"
                                    filter="true"
                                    filterMatchMode="contains"
                                    label="#{bundle['necesidad.estrategia']}"
                                    required="#{necesidadParcial.requiredEstrategia()}"
                                    disabled="#{necesidadParcial.disableEstrategia()}">
                                    <p:ajax
                                        process="@this"
                                        update="estrategia, estrategiamsg"/>
                                    <f:selectItem 
                                        noSelectionOption="true"/>
                                    <f:selectItems 
                                        value="#{necesidadController.estrategias}" 
                                        var="estrategia" 
                                        itemLabel="#{estrategia.nombre}" 
                                        itemValue="#{estrategia}" />
                                </p:selectOneMenu>              
                                <p:message  
                                    id="estrategiamsg"
                                    for="estrategia"/>
                            </h:panelGroup>
                        </p:column>
                    </p:dataTable>
                    <f:facet
                        name="footer">
                        <p:panelGrid
                            columns="12"
                            layout="grid" 
                            columnClasses="ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2" 
                            styleClass="ui-panelgrid-blank">
                            <p:commandButton 
                                value="#{bundle['commons.btn.save']}"
                                title="#{bundle['commons.btn.save']}"
                                icon="ui-icon-disk"
                                actionListener="#{necesidadController.onSaveAssociateProcesses()}"
                                process="@form"
                                update=":main"/>
                            <p:commandButton 
                                value="#{bundle['commons.btn.back']}"
                                title="#{bundle['commons.btn.back']}"
                                icon="ui-icon-arrowreturn-1-w"
                                immediate="true"
                                actionListener="#{necesidadController.onBackToList()}"
                                rendered="#{!necesidadController.editable}"
                                update=":main"/>
                        </p:panelGrid>
                    </f:facet>
                </p:panel>
            </h:form>
        </p:panel>
    </ui:define>
</ui:composition>