<!DOCTYPE html>
<ui:composition 
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:p="http://primefaces.org/ui"
  template="/templates/plantillaPrincipal.xhtml">
  <ui:define
    name="content">
    <p:panel 
      id="main"
      styleClass="ui-fluid">
      <h:form
        id="frmlist"
        prependId="false">
        <h:outputText 
          value="#{bundle['formacion.title.list']}"/>
        <p:separator />
        <p:panel
          id="pnlfiltro">
          <p:panelGrid
            layout="grid" 
            columns="2"
            columnClasses="ui-grid-col-2,ui-grid-col-10" 
            styleClass="ui-panelgrid-blank">
            <!-- vigencia -->
            <p:outputLabel
              id="fltvigencialbl"
              for="fltvigencia"
              value="#{bundle['vigencia']}"/>
            <h:panelGroup>
              <p:selectOneMenu 
                id="fltvigencia" 
                value="#{formacionController.filtro.pae}" 
                converter="paeConverter"
                filter="true"
                filterMatchMode="contains"
                required="true">
                <p:ajax
                  process="@this"
                  listener="#{formacionController.onLoadList()}"
                  update="pnlfiltrobtns fltvigencialbl fltvigencia fltvigenciamsg dtlist"/>
                <f:selectItem 
                  noSelectionOption="true"/>
                <f:selectItems 
                  value="#{formacionController.vigencias}" 
                  var="novedad" 
                  itemLabel="#{novedad.vigencia}" 
                  itemValue="#{novedad}" />
              </p:selectOneMenu>              
              <p:message
                id="fltvigenciamsg"
                for="fltvigencia"/>
            </h:panelGroup>
          </p:panelGrid>
          <f:facet
            name="footer">
            <p:panelGrid
              id="pnlfiltrobtns"
              columns="12"
              layout="grid" 
              columnClasses="ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2,ui-grid-col-2" 
              styleClass="ui-panelgrid-blank">
              <p:commandButton 
                value="#{bundle['commons.btn.find']}"
                title="#{bundle['commons.btn.find']}"
                icon="ui-icon-search"
                actionListener="#{formacionController.onLoadList()}"
                process="@this pnlfiltro"
                update="frmlist"/>
              <p:commandButton 
                value="#{bundle['formacion.btn.consolidate.summary']}"
                title="#{bundle['formacion.btn.consolidate.detail']}"
                icon="ui-icon-action"
                actionListener="#{formacionController.consolidateTrainingNeeds()}"
                rendered="#{formacionController.enableConsolidateTrainingNeeds()}"
                process="@this pnlfiltro"
                update="frmlist">
                <p:confirm 
                  header="#{bundle['commons.cfmdlg.header']}" 
                  message="#{bundle['formacion.msg.confirm.consolidate.needs']}" 
                  icon="ui-icon-alert" />
              </p:commandButton>
            </p:panelGrid>
          </f:facet>
        </p:panel>
        <p:dataTable 
          id="dtlist"
          value="#{formacionController.list}"
          var="record"
          paginator="true" 
          paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
          rows="10"
          rowsPerPageTemplate="10,50,100"
          reflow="true"> 
          <p:column 
            headerText="#{bundle['nivelacademico']}"
            sortBy="#{record.carrera.nivelAcademico.descripcion}">
            <p:commandLink 
              title="#{bundle['commons.lbl.view.detail']}"
              action="#{formacionController.onRowSelect()}">
              <f:setPropertyActionListener 
                value="#{record}" 
                target="#{formacionController.selected}" />
              <h:outputText 
                value="#{record.carrera.nivelAcademico.descripcion}"/>
            </p:commandLink>
          </p:column>
          <p:column 
            headerText="#{bundle['formacion.carrera']}"
            sortBy="#{record.carrera.titulo}">
            <p:commandLink 
              title="#{bundle['commons.lbl.view.detail']}"
              action="#{formacionController.onRowSelect()}">
              <f:setPropertyActionListener 
                value="#{record}" 
                target="#{formacionController.selected}" />
              <h:outputText 
                value="#{record.carrera.titulo}"/>
            </p:commandLink>
          </p:column>
          <p:column 
            headerText="#{bundle['formacion.proceso']}"
            sortBy="#{record.proceso.nombre}">
            <p:commandLink 
              title="#{bundle['commons.lbl.view.detail']}"
              action="#{formacionController.onRowSelect()}">
              <f:setPropertyActionListener 
                value="#{record}" 
                target="#{formacionController.selected}" />
              <h:outputText 
                value="#{record.proceso.nombre}"/>
            </p:commandLink>
          </p:column>
          <p:column 
            headerText="#{bundle['formacion.necesidad']}"
            sortBy="#{record.necesidad}">
            <p:commandLink 
              title="#{bundle['commons.lbl.view.detail']}"
              action="#{formacionController.onRowSelect()}">
              <f:setPropertyActionListener 
                value="#{record}" 
                target="#{formacionController.selected}" />
              <h:outputText 
                value="#{record.necesidad}"/>
            </p:commandLink>
          </p:column>
          <p:column 
            headerText="#{bundle['formacion.estado']}"
            sortBy="#{record.estado}">
            <p:commandLink 
              title="#{bundle['commons.lbl.view.detail']}"
              action="#{formacionController.onRowSelect()}">
              <f:setPropertyActionListener 
                value="#{record}" 
                target="#{formacionController.selected}" />
              <h:outputText 
                value="#{record.estado}"/>
            </p:commandLink>
          </p:column>
        </p:dataTable>
      </h:form>
    </p:panel>
  </ui:define>
</ui:composition>